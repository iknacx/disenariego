---
import { Image } from "astro:assets";
import Logo from "../assets/images/logo.svg";

import { Menu, X } from "@lucide/astro";

const currentPath = Astro.url.pathname;

const active =
    "block text-sm font-medium py-2 px-2.5 hover:text-zinc-950 focus:outline-none text-zinc-900";
const inactive =
    "block text-sm font-medium py-2 px-2.5 hover:text-zinc-950 focus:outline-none text-zinc-600";

const navItems = [
    { label: "Inicio", href: "/" },
    { label: "Nosotros", href: "/about" },
    { label: "Servicios", href: "/services" },
    { label: "Galería", href: "/gallery" },
    { label: "Contacto", href: "/contact" },
];
---

<nav
    class="fixed top-0 w-full md:max-w-[90%] md:top-8 left-1/2 -translate-x-1/2 flex flex-col md:flex-row md:w-fit z-30 justify-between md:rounded-2xl shadow bg-green-200/60 backdrop-blur-sm border border-green-200/70 px-2.5 py-3 transition-opacity md:transition-all md:duration-300 opacity-100">
    <div class="w-full flex justify-between items-center">
        <a
            class="py-1 px-2.5 self-center place-self-center my-auto flex justify-center items-center gap-6"
            href="/">
            <Logo class="h-6 w-auto my-auto" />
            <span class="md:hidden text-foreground text-xl tracking-wider"
                >Diseña Riego</span
            >
        </a>
        <div
            class="hidden md:block h-6 w-1 border-r border-zinc-400 py-2 mx-2.5 my-auto">
        </div>

        <button
            id="menu-btn"
            class="md:hidden p-2 text-foreground cursor-pointer">
            <Menu id="menu-icon" class="size-6" />
            <X id="close-icon" class="size-6 hidden" />
        </button>
    </div>
    <div class="hidden md:flex">
        {
            navItems.map((item) => (
                <a
                    key={item.label}
                    href={item.href}
                    class={currentPath === item.href ? active : inactive}>
                    {item.label}
                </a>
            ))
        }
    </div>

    <div
        id="menu"
        class="max-h-0 overflow-hidden opacity-0
                    transition-all duration-300 ease-in-out
                    md:hidden">
        {
            navItems.map((item) => (
                <a
                    key={item.label}
                    href={item.href}
                    class={currentPath === item.href ? active : inactive}>
                    {item.label}
                </a>
            ))
        }
    </div>

    <script>
        function closeMenu() {
            const menu = document.getElementById("menu");
            const menuIcon = document.getElementById("menu-icon");
            const closeIcon = document.getElementById("close-icon");

            if (!menu) return;

            menu.classList.add("max-h-0", "opacity-0");
            menu.classList.remove("max-h-96", "opacity-100", "pb-4");
            menuIcon?.classList.remove("hidden");
            closeIcon?.classList.add("hidden");
        }

        function initMenu() {
            const btn = document.getElementById("menu-btn");
            const menu = document.getElementById("menu");
            const menuIcon = document.getElementById("menu-icon");
            const closeIcon = document.getElementById("close-icon");

            if (!btn || !menu) return;

            // Clonar el botón para eliminar listeners duplicados de navegaciones anteriores
            const newBtn = btn.cloneNode(true);
            btn.parentNode.replaceChild(newBtn, btn);

            newBtn.addEventListener("click", () => {
                const isOpen = menu.classList.contains("max-h-0");

                if (isOpen) {
                    menu.classList.remove("max-h-0", "opacity-0");
                    menu.classList.add("max-h-96", "opacity-100", "pb-4");
                } else {
                    menu.classList.add("max-h-0", "opacity-0");
                    menu.classList.remove("max-h-96", "opacity-100", "pb-4");
                }

                menuIcon.classList.toggle("hidden");
                closeIcon.classList.toggle("hidden");
            });

            // Cerrar el menú al hacer clic en cualquier link
            menu.querySelectorAll("a").forEach((link) => {
                link.addEventListener("click", closeMenu);
            });
        }

        // Inicializar en cada navegación y cerrar el menú si quedó abierto
        document.addEventListener("astro:page-load", () => {
            closeMenu();
            initMenu();
        });
    </script>
</nav>
